<html>
<head>
<title>View log (Simple Window Saver)</title>
<script>
  backgroundPage = chrome.extension.getBackgroundPage();
  
  // get all the log data from the debug database
  function updateLogView() {
    backgroundPage.debug.db.transaction(function(tx) {
      tx.executeSql('SELECT * FROM event_log', [], renderLogs, backgroundPage.debug.onError);
    });
  }
  
  // update the textarea with the log data
  function renderLogs(tx, rs) {
    var rowOutput = '';
    for (var i=0; i < rs.rows.length; i++) {
      rowOutput += renderLog(rs.rows.item(i));
    }
    var logsElement = document.getElementById('logs');
    logsElement.innerHTML = rowOutput;
  }
  
  // render a single log row
  function renderLog(row) {
    var timeStamp = new Date(row.time_stamp);
    return row.event_type + ', ' + row.window_id + ', ' + row.tab_id + ', ' + timeStamp.getTime() + '\n';
  }
  
  // delete all the log data
  function deleteAllLogs() {
    if (confirm('Do you really want to delete all log data?')) {
      backgroundPage.debug.db.transaction(function(tx) {
        tx.executeSql('DELETE FROM event_log', null, init, backgroundPage.debug.onError);
      });
    }
  }
</script>
</head>
<body onload="updateLogView();">
CSV Format: 'event_type, window_id, tab_id, timestamp (ms since epoch)'<br>
<textarea cols="80" rows="40" id="logs">No events logged yet.</textarea><br>
<a href="javascript:deleteAllLogs();">delete all log data</a>
</body>
</html>
